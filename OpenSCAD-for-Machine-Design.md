# Overview

Assembled best practices on using OpenSCAD for complex machine design (e.g. CNC machines, robotics).

## Principles

* Integrated with github, but easily extended to other SCMs
* Support efficient, robust collaborative design:
  * Clear naming conventions, coding styles and file structure
* Encourage reusable parts that can be shared across projects
* Automate slow, repetitive tasks, such as:
  * STL generation
  * Bill of Materials (BOM) generation
  * Assembly Guide generation
  * Pretty pictures for Assembly Guide, website, etc
* All documentation in markdown format, so... 
  * it can be rendered automatically by github
  * it can be rendered into different formats (HTML, PDF)
  * it is very readable


## Concepts to cover

* Vitamins, printed-parts and assemblies
* Project structure
* Conventions for vitamins
* Parameterisation of vitamins (enum types)
* Conventions for printed-parts
* Conventions for assemblies
* BOM generation (headlines only)
* Connector concept
* Using attach()
* Representing assembly sequences with step()
* Connector getter functions

## Vitamins, Printed-parts and Assemblies

Models of complete machines are comprised of two fundamental building blocks - parts and assemblies:
* Parts - represent the individual, physical bits of the machine
* Assemblies -  represent how the parts should be put together

Assemblies are typically arranged in a tree structure, with a top-level assembly containing a combination of parts and sub-assemblies.

Because OpenSCAD is primarily used for creating 3D-printable designs, we adopt the convention of classifing our parts into two types:
* Printable parts - STL
* Non-printable parts - Vitamins

A typical design process will rapidly iterate over the following steps:
* Import, or develop, the key vitamins (often drive systems and electronics)
* Layout groups of vitamins within assemblies
* Develop the printed parts to hold the vitamins together
* Print, test, repeat

Project teams can often tackle these steps in parallel, with team members owning development of the various vitamins, printed-parts and assemblies.  


## Project Structure

Each machine design is placed in it's own project directory, laid out as follows:

Directory | Contains
------------ | ------------
.              | Top-level .scad file for the project, the Assembly Guide and the various build automation tools
assemblies | The scad files that describe all the printable parts and sub-assemblies of LogoBot
bom |  Generated 
config | Global configuration files
images | Generated images
sandbox | Playground for developing parts and assemblies
stl | Generated STL for printed parts
utils | Utility scad files to provide assembly functionality, speed modelling, etc 
views | Scad files describing specific views of the overall project, sub-assemblies, etc - automatically rendered
vitamins | Models of all the non-printable parts (e.g. motors, switches, nuts, bolts)


## Vitamins




## Assembly Guide

The project structure and automation tools are designed to produce an assembly guide with minimal effort.  Many parts of the assembly guide are generated by the build automation tools, typically leaving just the introduction to be written separately.  The guide is always named AssemblyGuide.md and is located in the root project directory.  


## Build Automation

Automation tools:
* BOM Generator (bom.py)
* STL Generator (stls.py)
* Vitamins Generator (vitamins.py)
* Views Generator (views.py)
* Publisher (publish.py)

All of the above are wrapped into a single build script (build.py).

### BOM Generator

Generates bill-of-material summaries for the overall project and each assembly -  in individual files, in markdown format.  All of the files are placed in the /bom directory.  Each file has a common format:
* A list of Vitamins
* A list of Printed Parts (STL)
* A list of sub-assemblies
* A list of assembly steps

The generated markdown includes links to source files and images (generated by the other tools).  The files are designed to be included into the overall Assembly Guide for the project.

How STLs and Vitamins are handled:

| Automation Tool | STL  | Vitamin |
| --------------- | ---- | ------- |
| BOM Generator   | Placed in the printed parts list | Placed in the vitamins list |
| Thumbnail view  | Placed in the /images dir | Place in the vitamins/views directory, one image per vitamin variant(type) |
| STL Generator   | Placed in the /stl dir ready for printing | Placed in the vitamins/stl directory and used to accelerate on-screen rendering, one STL per vitamin sub-part per variant (type) |
| AssemblyGuide   | Auto-linked to a 3D viewer | not linked |

## Continuous Integration and Deployment

Jenkins to trigger automatic integration testing and deployment (if tests pass) on commit to staging branch.  Validation reports should be in markdown format.  Should they auto-submit issues?

* Static analysis (lint style) - rules vary by .scad type (e.g. assembly, vitamin).  Should include checking for various interface modules (e.g. _View)
* Log and .csg analysis - using Openscad output log and dummy.csg
* BOM generation - report errors
* vitamin STL generation
* vitamin view rendering
* STL generation
* STL view rendering
* Other views rendering
* Summarise errors?  
* Create github issues?  
* Auto-commit to staging (for images, STL and markdown)
* Publish web content (to gh-pages branch)
* Send notifications (twitter?)


### Static Analysis Rules

#### Root .scad

Validate...
* Inclusion of global config file

#### Assemblies

Validate... 
* Filename format
* Module name matches filename
* Assembly module contains step() calls
* File does not contain any include or use statements
* Any variables have correct naming convention
* Any supplementary modules have correct naming convention
* Any functions have correct naming convention
* Any included _STL modules have associated _View modules
* _View modules contain an echo line with correct structure

#### Vitamins
Validate...
* Filename format
* Module name matches filename
* Module accepts a single parameter, or none
* Any include or use statements are within the /vitamins directory or a sub-directory
* Any variables have correct naming convention
* Any supplementary modules have correct naming convention
* Any functions have correct naming convention
* Contains a _View module that accepts a single parameter, or none
* _Part modules contain echo lines with correct structure, and that those echo contents exist as modules
* _View modules contain an echo line with correct structure


#### Views

None


### Log/CSG Analysis Rules

#### All

* No syntax errors
* No warnings
* dummy.csg is produced
* dummy.csg contains more than empty group (or groups)

#### Assemblies

Check global rules, when the assembly module is called.

#### Vitamins

Check global rules, when the following are called:
* Vitamin module
* _Parts module
* _View module
* any defined Parts


### BOM Generation

* Check all referenced .scad files and modules exist - is that done here? or later?


## References

* Mendel90 design
* http://www.cannymachines.com/entries/9/openscad_dimensioned_drawings

 